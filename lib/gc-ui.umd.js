(function(C,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("ant-design-vue"),require("lodash-es")):typeof define=="function"&&define.amd?define(["exports","vue","ant-design-vue","lodash-es"],e):(C=typeof globalThis<"u"?globalThis:C||self,e(C["gc-ui"]={},C.Vue,C.AntDesignVue,C.LodashEs))})(this,function(C,e,r,S){"use strict";const O={class:"table-page-search-wrapper mrgin-bottom-16"},U={class:"table-page-search-submitButtons"},Y={name:"BaseSearch"},M=e.defineComponent({...Y,props:{searchOptions:{type:Object,default:()=>{}},enableExport:{type:Boolean,default:!1},enableImport:{type:Boolean,default:!1},enableCreate:{type:Boolean,default:!1}},emits:["search","reset","create","import","export"],setup(m,{expose:g,emit:p}){const n=r.TreeSelect.SHOW_PARENT,y=m,k=p,o=e.ref({}),f=e.computed(()=>{const i={};return Object.keys(o.value).forEach(a=>{S.isArray(o.value[a])&&o.value[a].find(w=>w==="tree-all")||o.value[a]!==null&&o.value[a]!==void 0&&(i[a]=o.value[a])}),i}),c=i=>i==="hour"||!i?"date":i,s=i=>i==="hour"?{format:"HH:mm:ss"}:!1,h=i=>{switch(i){case"hour":return"YYYY-MM-DD HH:mm:ss";case"date":return"YYYY-MM-DD";case"month":return"YYYY-MM";case"year":return"YYYY";default:return"YYYY-MM-DD"}},u=()=>{o.value={};const i=y.searchOptions||{};Object.keys(i).forEach(a=>{i[a].type.toLowerCase()==="treeselect"&&(o.value[a]=["tree-all"])}),k("reset",f.value)},B=(i=!0)=>{console.log(f.value),k("search",f.value,i)},b=()=>{console.log("导出"),k("export",f.value)},x=()=>{console.log("导入"),k("import",f.value)},_=()=>{k("create")},N=(i={},a=!0)=>{o.value={...o.value,...i},B(a)};return e.watchEffect(()=>{o.value={};const i=y.searchOptions;Object.keys(i).forEach(a=>{i[a].type.toLowerCase()==="treeselect"&&(o.value[a]=["tree-all"])})}),g({setQueryParam:N,onSearch:B,onReset:u,onImport:x,onExport:b}),(i,a)=>{const w=e.resolveComponent("a-input-number");return e.openBlock(),e.createElementBlock("div",O,[e.createVNode(e.unref(r.Form),{colon:!1},{default:e.withCtx(()=>[e.createVNode(e.unref(r.Row),{gutter:24},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.searchOptions,(t,l)=>(e.openBlock(),e.createBlock(e.unref(r.Col),{key:l,md:6,sm:24},{default:e.withCtx(()=>[e.createVNode(e.unref(r.FormItem),{label:t.label},{default:e.withCtx(()=>[t.type.toLowerCase()==="number"?(e.openBlock(),e.createBlock(w,{key:0,value:o.value[t.name],"onUpdate:value":d=>o.value[t.name]=d,valueModifiers:{trim:!0},max:99999999,placeholder:"请输入"+t.label,controls:!1,style:{width:"100%"}},null,8,["value","onUpdate:value","placeholder"])):e.createCommentVNode("",!0),t.type.toLowerCase()==="string"?(e.openBlock(),e.createBlock(e.unref(r.Input),{key:1,value:o.value[t.name],"onUpdate:value":d=>o.value[t.name]=d,valueModifiers:{trim:!0},placeholder:"请输入"+t.label},null,8,["value","onUpdate:value","placeholder"])):t.type.toLowerCase()==="datapicker"?(e.openBlock(),e.createBlock(e.unref(r.DatePicker),{key:2,value:o.value[t.name],"onUpdate:value":d=>o.value[t.name]=d,picker:c(t==null?void 0:t.picker),"show-time":s(t==null?void 0:t.picker),format:h(t==null?void 0:t.picker),"value-format":h(t==null?void 0:t.picker),style:{width:"100%"}},null,8,["value","onUpdate:value","picker","show-time","format","value-format"])):t.type.toLowerCase()==="rangepicker"?(e.openBlock(),e.createBlock(e.unref(r.RangePicker),{key:3,value:o.value[t.name],"onUpdate:value":d=>o.value[t.name]=d,picker:c(t==null?void 0:t.picker),"show-time":s(t==null?void 0:t.picker),format:h(t==null?void 0:t.picker),"value-format":h(t==null?void 0:t.picker),style:{width:"100%"}},null,8,["value","onUpdate:value","picker","show-time","format","value-format"])):t.type.toLowerCase()==="select"?(e.openBlock(),e.createBlock(e.unref(r.Select),{key:4,value:o.value[t.name],"onUpdate:value":d=>o.value[t.name]=d,placeholder:"请选择"+t.label,options:t.options},null,8,["value","onUpdate:value","placeholder","options"])):t.type.toLowerCase()==="treeselect"?(e.openBlock(),e.createBlock(e.unref(r.TreeSelect),{key:5,value:o.value[t.name],"onUpdate:value":d=>o.value[t.name]=d,"max-tag-count":1,"show-checked-strategy":e.unref(n),"tree-data":[{label:"全部",value:"tree-all",children:t.options}],"tree-checkable":"","tree-default-expand-all":"","allow-clear":"",placeholder:"请选择"+t.label,"tree-node-filter-prop":"label"},null,8,["value","onUpdate:value","show-checked-strategy","tree-data","placeholder"])):e.createCommentVNode("",!0)]),_:2},1032,["label"])]),_:2},1024))),128)),e.createVNode(e.unref(r.Col),{md:6,sm:24},{default:e.withCtx(()=>[e.createElementVNode("span",U,[e.createVNode(e.unref(r.Space),null,{default:e.withCtx(()=>[e.createVNode(e.unref(r.Button),{type:"primary",onClick:a[0]||(a[0]=t=>B())},{default:e.withCtx(()=>a[3]||(a[3]=[e.createTextVNode("查询")])),_:1}),e.createVNode(e.unref(r.Button),{onClick:u},{default:e.withCtx(()=>a[4]||(a[4]=[e.createTextVNode("重置")])),_:1}),m.enableCreate?(e.openBlock(),e.createBlock(e.unref(r.Button),{key:0,type:"primary",class:"create",onClick:_},{default:e.withCtx(()=>a[5]||(a[5]=[e.createTextVNode("新增")])),_:1})):e.createCommentVNode("",!0),m.enableExport?(e.openBlock(),e.createBlock(e.unref(r.Button),{key:1,type:"primary",onClick:a[1]||(a[1]=t=>b())},{default:e.withCtx(()=>a[6]||(a[6]=[e.createTextVNode("导出")])),_:1})):e.createCommentVNode("",!0),m.enableImport?(e.openBlock(),e.createBlock(e.unref(r.Button),{key:2,type:"primary",onClick:a[2]||(a[2]=t=>x())},{default:e.withCtx(()=>a[7]||(a[7]=[e.createTextVNode("导入")])),_:1})):e.createCommentVNode("",!0)]),_:1})])]),_:1})]),_:1})]),_:1})])}}}),E=((m,g)=>{const p=m.__vccOpts||m;for(const[n,y]of g)p[n]=y;return p})(M,[["__scopeId","data-v-df7c24fc"]]),R=m=>{console.log(m);const{searchOptions:g,...p}=m,n=e.shallowRef(),y=e.defineComponent((o,{attrs:f})=>()=>e.h(E,{searchOptions:g,ref:n,...p,...o,...f})),k=new Proxy({},{get(o,f){return()=>{var c,s;return(s=(c=n.value)==null?void 0:c[f])==null?void 0:s.call(c)}}});return[y,k]},A=(m,g=!0,p)=>{const n=e.reactive({search:{},tableData:[],selectedRowKeys:[],pagination:{size:"default",current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","30","40","50"],showTotal:s=>`共${s}条数据`,onChange:(s,h)=>{c(s,h)}},rowSelection:{checkStrictly:!0,onChange:s=>{n.selectedRowKeys=s}}}),y=()=>{const{pagination:{current:s,pageSize:h}={}}=n,u=S.isString(p)||S.isNumber(p)?p:{...p,...n.search},B={page:{page:s,size:h},param:u};if(!m)return r.message.error("API.getPage参数不存在");m(B).then(b=>{console.log(b,"res"),n.tableData=b.records,n.pagination.total=b.total,n.pagination.pageSize=h,n.pagination.current=s})},k=(s={},h=!0)=>{h&&(n.pagination.current=1,n.pagination.pageSize=10),n.search=s,y()},o=(s={})=>{n.pagination.current=1,n.pagination.pageSize=10,n.search={...s},y()},f=(s,...h)=>{p=s,k(...h)},c=(s,h)=>{n.pagination.pageSize=h,n.pagination.current=s,y()};return e.onMounted(()=>{g&&y()}),{...e.toRefs(n),search:n.search,onSearch:k,onReset:o,onSetParam:f}},T=e.defineComponent({__name:"index",props:{options:{}},setup(m){const g=m,p=e.computed(()=>g.options.search),n=e.computed(()=>g.options.table),y=e.computed(()=>g.options.modal),k=e.computed(()=>g.options.API),o=e.ref(0),f=e.ref(),c=e.reactive({name:""}),s=()=>{console.log("新增"),o.value=1},h=(w,t)=>{switch(w){case 1:console.log("编辑"),k.value.detailApi(t).then(l=>{console.log(l),o.value=1,e.nextTick(()=>{Object.assign(c,l)})});break;case 2:k.value.detailApi(t).then(l=>{o.value=2,e.nextTick(()=>{Object.assign(c,l)})}),console.log("查看");break;case 3:r.Modal.confirm({title:"确定删除吗？",content:"删除后不可恢复",onOk:()=>{k.value.delApi(t).then(()=>{r.message.success("删除成功"),a.onSearch()})},onCancel:()=>{}}),console.log("删除");break}},u=async()=>{if(console.log(111),o.value===1&&f.value)try{await f.value.validateFields(),console.log(c),c.id&&await k.value.putApi(c),c.id||await k.value.postApi(c),await f.value.resetFields(),o.value=0,a.onSearch(),r.message.success("操作成功")}catch(w){console.log(w)}else o.value=0},B=()=>{f.value&&(console.log(1),f.value.resetFields()),o.value=0},{tableData:b,pagination:x,onSearch:_,onReset:N}=A(k.value.getPage,n.value.init||!0,n.value.initParam),[i,a]=R({...p.value,onCreate:s,onSearch:_,onReset:N});return(w,t)=>(e.openBlock(),e.createElementBlock("div",null,[e.createVNode(e.unref(i)),e.createVNode(e.unref(r.Table),{bordered:n.value.bordered||!0,columns:n.value.columns,"data-source":e.unref(b),"row-key":n.value.rowKey||"id",scroll:n.value.scroll,pagination:e.unref(x)},{bodyCell:e.withCtx(({column:l,record:d,text:L,index:F})=>[e.renderSlot(w.$slots,"bodyCell",{column:l,record:d,text:L,index:F}),l.dataIndex==="action"?(e.openBlock(),e.createBlock(e.unref(r.Space),{key:0},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value.actions,(P,z)=>(e.openBlock(),e.createBlock(e.unref(r.Button),{key:z,type:P.type,onClick:H=>h(P.key,d.id)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(P.label),1)]),_:2},1032,["type","onClick"]))),128)),e.renderSlot(w.$slots,"action",{record:d})]),_:2},1024)):e.createCommentVNode("",!0)]),_:3},8,["bordered","columns","data-source","row-key","scroll","pagination"]),e.createVNode(e.unref(r.Modal),{title:y.value.title,open:o.value!==0,"destroy-on-close":"",onOk:u,onCancel:B},{default:e.withCtx(()=>[e.createVNode(e.unref(r.Form),e.mergeProps(y.value.form.config,{ref_key:"formRef",ref:f,model:c,disabled:o.value!==1}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value.form.fields,l=>(e.openBlock(),e.createBlock(e.unref(r.FormItem),e.mergeProps({key:l.name,ref_for:!0},l),{default:e.withCtx(()=>[l.type==="switch"?(e.openBlock(),e.createBlock(e.unref(r.Switch),e.mergeProps({key:0,checked:c[l.name],"onUpdate:checked":d=>c[l.name]=d,ref_for:!0},l.config),null,16,["checked","onUpdate:checked"])):l.type==="select"?(e.openBlock(),e.createBlock(e.unref(r.Select),e.mergeProps({key:1,value:c[l.name],"onUpdate:value":d=>c[l.name]=d,ref_for:!0},l.config),null,16,["value","onUpdate:value"])):l.type==="input"?(e.openBlock(),e.createBlock(e.unref(r.Input),e.mergeProps({key:2,value:c[l.name],"onUpdate:value":d=>c[l.name]=d,ref_for:!0},l.config),null,16,["value","onUpdate:value"])):l.type==="number"?(e.openBlock(),e.createBlock(e.unref(r.InputNumber),e.mergeProps({key:3,value:c[l.name],"onUpdate:value":d=>c[l.name]=d,ref_for:!0},l.config),null,16,["value","onUpdate:value"])):e.createCommentVNode("",!0)]),_:2},1040))),128))]),_:1},16,["model","disabled"])]),_:1},8,["title","open"])]))}}),I={install:m=>(m.component("GTablePage",T),m)};C.GTablePage=T,C.default=I,Object.defineProperties(C,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
